# API для плагинов

Основные методы и поля, которые вы можете переопределить в коде темы для Собираки. Методы могут использоваться как в `HtmlTheme`, так и в `PdfTheme`.

{% include 'unstable-api.md' %}

## `process_*()` {#process}

```python
async def process_image(self, image: Image, page: Page) -> tuple[Element, ...]: ...
async def process_para(self, para: Para, page: Page) -> tuple[Element, ...]
async def process_table(self, table: Table, page: Page) -> tuple[Element, ...]: ...
# ...и другие подобные методы
```

С помощью таких методов код плагина может подменять элементы синтаксического дерева страницы.

Для работы с содержимым каждой страницы Собирака использует утилиту [Pandoc](https://pandoc.org/) и библиотеку [Panflute](http://scorreia.com/software/panflute/). Каждый элемент дерева представлен объектом класса, унаследованного от `Element`. Корневой элемент страницы представлен объектом класса `Doc`.

На одном из финальных этапов сборки документации Собирака вызывает метод `process_doc()` из используемого плагина. Этот метод принимает и возвращает объект класса `Doc`. Этот метод вызывает обработку дочерних элементов, каждый из которых, в свою очередь, в реализации по умолчанию также вызывает обработку своих дочерних элементов. Код плагина может переопределить один или несколько из таких методов, чтобы изменить определённые свойства элементов или заменить их полностью.

Каждый метод должен возвращать кортеж из объектов класса `Element`. Во многих ситуациях имеет смысл возвращать кортеж из одного исходного элемента, предварительно вызвав реализацию метода по умолчанию, чтобы обработать дочерние объекты. Если вместо этого вернуть пустой кортеж, элемент будет удалён из дерева. Также, возвращая нужный кортеж, можно заменить элемент на один или несколько других элементов.

Полный список плагинов `process_*()` можно найти в базовом классе `sobiraka.processing.abstract.dispatcher.Dispatcher`.

## `process_div_*()` {#process_div}

```python
async def process_div_example(self, div: Div, page: Page) -> tuple[Element, ...]: ...
```

Если элемент класса `Div` имеет один и только один класс (например, заданный через [fenced divs](https://pandoc.org/MANUAL.html#extension-fenced_divs) в Markdown), Собирака попробует обработать его методом `process_div_*()`, подставив класс вместо `*`. При отсутствии такого метода будет вызван обычный `process_div()`.

:::example
**Пример.** Блок, который вы читаете прямо сейчас, имеет класс `example`. Такой блок обрабатывается методом `process_div_example()`.
:::

## `process_role_*()` {#process_role}

```python
async def process_role_doc(self, code: Code, page: Page) -> tuple[Element, ...]: ...
```

Эта часть API актуальна только для формата [ReST](../2-syntax/2-rest.md).

Методы с такими именами вызываются для обработки элементов (формально принадлежащих классу `Code`) с определёнными [ролями](https://www.sphinx-doc.org/en/master/usage/restructuredtext/roles.html).

:::example
**Пример.** Для обработки конструкции `` :myrole:`Text` `` будет вызван метод `process_role_myrole()`.
:::