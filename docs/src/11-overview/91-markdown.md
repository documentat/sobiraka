# Поддержка Markdown

Markdown — основной синтаксис исходного текста, поддерживаемый Собиракой. Все файлы с расширением `.md`, а также все файлы с неопознанными расширениями (то есть не [`.rst`](92-rest.md)), интерпретируются как файлы в формате Markdown.

Собирака использует вариацию Markdown, реализованную в конвертере Pandoc. Полную документацию по его особенностям можно найти здесь: [Pandoc’s Markdown](https://pandoc.org/MANUAL.html#pandocs-markdown).

По сравнению с конфигурацией Pandoc по умолчанию, в Собираке выключены расширения [`smart`](https://pandoc.org/MANUAL.html#extension-smart), [`raw_html`](https://pandoc.org/MANUAL.html#extension-raw_html), [`raw_tex`](https://pandoc.org/MANUAL.html#extension-raw_tex) и [`implicit_figures`](https://pandoc.org/MANUAL.html#extension-implicit_figures), а также добавлено расширение [`mark`](https://pandoc.org/MANUAL.html#extension-mark). Также в файлах Markdown, как и в любых текстовых файлах для Собираки, можно использовать [директивы](../12-syntax/3-directives.md) и [синтаксис Jinja](../12-syntax/2-jinja.md).

Ниже перечислены некоторые наиболее важные особенности Pandoc Markdown и порядок их обработки.

## Заголовки {#headers}

Заголовок первого уровня интерпретируется как простой текст без форматирования. Он обрабатывается отдельно от тела страницы — в частности, это означает, что заголовок и тело страницы передаются в разных переменных для [HTML-шаблона](../99-reference/3-template-api.md).

Если после заголовка стоит конструкция `{-}`, Собирака исключает его из [автонумерации](02-files.md#autonumeration).

## Подзаголовки {#subheaders}

Заголовок любого уровня, кроме первого, интерпретируется как блочный элемент и может содержать форматирование.

Если после заголовка стоит конструкция `{-}`, Собирака исключает его из [автонумерации](02-files.md#autonumeration).

Каждому заголовку назначается идентификатор (см. [`header_attributes`](https://pandoc.org/MANUAL.html#extension-header_attributes)). Этот идентификатор следует указывать в [ссылках на подзаголовок](../12-syntax/1-links.md#anchor-links), а при сборке [HTML](../21-build-html/) он же может быть виден читателю в строке браузера при переходе к подзаголовку из оглавления.

Если идентификатор не указан явно, то он формируется автоматически на основе текста заголовка. За автоматическое формирование идентификатора отвечает Pandoc Markdown (см. [`auto_identifiers`](https://pandoc.org/MANUAL.html#extension-auto_identifiers)), но это поведение может измениться в будущих версиях Собираки. Для заголовков, ссылки на которые важно сохранять неизменными, рекомендуется указывать идентификаторы эксплицитно.

::: example
**Пример.** В документе, показанном ниже, первый подзаголовок получит автоматический идентификатор `шаг-первый-взять`, а второй — вручную указанный идентификатор `step2`.

```
# Как сделать
## Шаг первый: взять
## Шаг второй: сделать {#step2}
```

:::

Обратите внимание, что если на одной странице есть несколько подзаголовков с одинаковыми идентификаторами, это может привести к некорректной работе оглавления и затруднить навигацию для читателя. Собирака предупреждает о таких ситуациях, а если они приводят к неоднозначности [ссылок на подзаголовки](../12-syntax/1-links.md#anchor-links) — прекращает сборку.

## Ссылки {#links}

Обработка всех ссылок, в том числе написанных как [reference links](https://pandoc.org/MANUAL.html#reference-links), происходит в соответствии с правилами, описанными в разделе [](../12-syntax/1-links.md).

## Инфоблоки {#admonitions}

Инфоблоки не являются отдельным типом с точки зрения Pandoc Markdown, однако конкретная тема оформления может реализовывать специальное оформление для блоков с определёнными _классами_: например, “info”, “warning”, “example” и т.п. Назначать блокам классы можно с помощью расширения [`fenced_divs`](https://pandoc.org/MANUAL.html#extension-fenced_divs).

Набор поддерживаемых классов зависит от реализованных функций [`process_div_*()`](../99-reference/4-processor-api.md#process_div) в обработчике страниц.

::: example
**Пример.** Обработчик страниц, входящий в тему оформления `book`, содержит реализацию функции `process_div_warning()`. Это значит, что в проектах с этой темой можно писать предупреждения так:

```
::: warning
Мойте руки после еды, если еда была грязная.
:::
```

:::

## Блоки кода {#code}

Чтобы вставить в документацию блок кода, добавьте три обратных апострофа `` ``` `` до и после кода. Опционально к апострофам перед кодом можно добавить обозначение синтаксиса, например, `` ```json `` — для таких блоков может работать подсветка синтаксиса. Есть и [более сложные способы](https://pandoc.org/MANUAL.html#verbatim-code-blocks) оформления вставок кода.

`````
```json
{"result": 42}
```
`````

При сборке HTML-документации Собирака позволяет включить подсветку синтаксиса через библиотеки [highlight.js](https://highlightjs.org/), [Prism](https://prismjs.com/) или [Pygments](https://pygments.org/) — в зависимости от настройки [`web.highlight`](../99-reference/1-configuration.md#web.highlight). У каждой библиотеки свой набор поддерживаемых языков и свой набор стандартных стилей.

При сборке PDF-документации можно использовать только [Pygments](https://pygments.org/) — её следует включить настройкой [`pdf.highlight`](../99-reference/1-configuration.md#pdf.highlight).

Обратите внимание, что поведение библиотеки Pygments (при использовании для HTML или PDF) может меняться в зависимости от аргументов, переданных при инициализации _лексера_. Полный список аргументов для каждого лексера [приведён в официальной документации](https://pygments.org/docs/lexers/). Так, лексер [`PhpLexer`](https://pygments.org/docs/lexers/#pygments.lexers.php.PhpLexer), отвечающий в Pygments за подсветку языка PHP, не подсвечивает PHP-код без открывающего тега `<?php`, если ему не передан аргумент `startinline=true`. Чтобы передать этот или любой другой аргумент, укажите его в фигурных скобках (см. синтаксис [`fenced_code_attributes`](https://pandoc.org/MANUAL.html#extension-fenced_code_attributes) в Pandoc). Например:

`````
```php {startinline=true}
echo 'Hello, world!'
```
`````

## Низкоуровневый код {#raw}

Pandoc Markdown содержит расширение [`raw_attribute`](https://pandoc.org/MANUAL.html#extension-raw_attribute), с помощью которого можно писать фрагменты документации не в формате Markdown, а в более низкоуровневом формате. Присутствует возможность включать как блочные, так и инлайновые фрагменты с низкоуровневым кодом.

Фрагменты с конструкцией `{=html}` включаются без изменений в HTML-файлы, но опускаются при сборке PDF.

Фрагменты с конструкцией `{=tex}` включаются без изменений в LaTeX-код для PDF-файлов, но опускаются при сборке HTML.

::: example

**Пример.** Конструкция, приведённая ниже, превращается в LaTeX-команду `\clearpage` (разрыв страницы) при сборке PDF. Конструкция полностью игнорируется при сборке HTML.

```
`\clearpage`{=tex}
```

:::

См. также [условия Jinja](../12-syntax/2-jinja.md#conditions).