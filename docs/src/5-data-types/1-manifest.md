# Манифест проекта

_Манифест_ — файл в формате YAML, который определяет все настройки [проекта](../1-concepts/1-volumes.md).

Все пути в манифесте ([`paths.root`](#volume.paths.root), [`lint.dictionaries`](#volume.lint.dictionaries) и т.п.) указываются относительно директории, в которой находится манифест.

::: note
Если ваш текстовый редактор поддерживает работу с JSON Schema, вы можете подключить схему из файла `sobiraka-project.yaml`, чтобы комфортнее редактировать манифест вашего проекта.
:::

## Общая структура и примеры

Общая структура манифеста может выглядеть по-разному в зависимости от сложности проекта, который он описывает.

### Два языка, два тома {#example-2v-2l}

Данный пример описывает проект, содержащий два языка (`en` и `ru`) и два тома (`admin-manual` и `user-manual`). Каждая языковая версия каждого тома имеет собственные настройки [`title`](#volume.title) и [`paths.root`](#volume.paths.root).

```yaml
primary: admin-manual
languages:
  en:
    volumes:
      admin-manual:
        title: Admin manual
        paths:
          root: src/en/admin-manual
      user-manual:
        title: User manual
        paths:
          root: src/en/user-manual
  ru:
    volumes:
      admin-manual:
        title: Руководство администратора
        paths:
          root: src/ru/admin-manual
      user-manual:
        title: Руководство пользователя
        paths:
          root: src/ru/user-manual
```

### Два языка, один том {#example-2v-1l}

Данный пример описывает проект из одного тома, представленного на двух языках (`en` и `ru`). В отличие от примера [«Два языка, два тома»](#example-2v-2l), здесь не используется конструкция `volumes`: вместо этого ключам `en` и `ru` соответствуют непосредственно настройки тома.

```yaml
primary: ru
languages:
  en:
    title: Manual
    paths:
      root: src/en
  ru:
    title: Руководство
    paths:
      root: src/ru
```

### Один язык, два тома {#example-1v-2l}

Данный пример описывает проект, содержащий два тома (`admin-manual` и `user-manual`) на одном языке. В отличие от примера [«Два языка, два тома»](#example-2v-2l), здесь опускается конструкция `languages`, а конструкция `volumes` вынесена на верхний уровень.

```yaml
primary: admin-manual
volumes:
  admin-manual:
    title: Admin manual
    paths:
      root: src/admin-manual
  user-manual:
    title: User manual
    paths:
      root: src/user-manual
```

### Один язык, один том {#example-1v-1l}

Данный пример описывает проект из одного тома на одном языке. Конструкции `languages` и `volumes` опускаются.

```yaml
title: Admin manual
paths:
  root: src/admin-manual
```

## Глобальные свойства

### `primary_language`

Язык, который используется в качестве первоисточника при переводе томов, см. [Мультиязычность](../1-concepts/2-multilang.md).

Если настройка не задана, то используется первый язык в порядке объявления в манифесте.

## Свойства тома

### `title` {#volume.title}

Заголовок документа. Используется для формирования заголовков страниц при [сборке HTML](../3-output/1-html.md).

### `paths.root` {#volume.paths.root}

Директория, в которой находятся исходные текстовые файлы. Если не указана, то будет использоваться директория, в которой находится файл манифеста.

### `paths.include` {#volume.paths.include}

Список из одного или нескольких шаблонов для включения текстовых файлов в том.

Использование этой настройки позволяет избежать нежелательных эффектов, если вы используете один и тот же корень для нескольких томов или совмещаете корни текстовых файлов и ресурсов. Так, вы можете указать шаблон `**/*_ru.md` для русскоязычного тома и `**/*_en.md` для англоязычного, при этом ни в один из них не попадут файлы, отличные от Markdown.

Для поиска файлов по шаблонам используются функции из библиотеки [`wcmatch`](https://facelessuser.github.io/wcmatch/glob/) с включёнными опциями `GLOBSTAR` и `NODIR`. Если указано несколько шаблонов, то в том попадут файлы, соответствующие хотя бы одному из них (и не соответствующие ни одному из шаблонов [`paths.exclude`](#volume.paths.exclude)). Если настройка не задана, то используется один шаблон `**/*`, которому соответствуют все файлы на любой глубине.

### `paths.exclude` {#volume.paths.exclude}

Список из одного или нескольких шаблонов для исключения текстовых файлов из тома.

Собирака использует эти шаблоны после [`paths.include`](#volume.paths.include), чтобы удалить лишнее из списка найденных файлов.

Для поиска файлов по шаблонам используются функции из библиотеки [`wcmatch`](https://facelessuser.github.io/wcmatch/glob/) с включёнными опциями `GLOBSTAR` и `NODIR`. Если указано несколько шаблонов, то из тома будут исключены файлы, соответствующие хотя бы одному из них. Если настройка не задана, то никакие файлы не будут исключены.

### `paths.resources` {#volume.paths.resources}

Директория, в которой находятся изображения, видео и прочие ресурсы для документации.

### `paths.naming_scheme` {#volume.paths.naming_scheme}

Список регулярных выражений для парсинга имён исходных файлов.

При анализе исходного файла или директории с исходными файлами Собирака перебирает регулярные выражения в указанном порядке и проверяет, соответствует ли им имя файла. Когда подходящее выражение найдено, перебор прекращается, а из результата проверки извлекаются (при наличии) именованные группы `index` и `stem`. Группа `index` должна представлять собой целое число и будет использована при сортировке файлов из одной директории. Группа `stem` может представлять собой любую строку и будет использована для выбора имени конечного файла при [сборке HTML](../3-output/1-html.md).

По умолчанию используются следующие регулярные выражения:

- `(?P<index>\d+) - (?P<stem>.+)`
- `(?P<index>\d+)'`
- `(?P<stem>.+)'`

Регулярные выражения должны быть совместимы со стандартной функцией [`re.fullmatch()`](https://docs.python.org/3/library/re.html#re.fullmatch) с включённым флагом [`re.VERBOSE`](https://docs.python.org/3/library/re.html#re.X).

### `content.numeration` {#volume.content.numeration}

Если `true`, то в начало каждого заголовка в документации будет добавлен его порядковый номер.

### `html.toc_depth` {#volume.html.toc_depth}

Глубина, до которой должны быть раскрыты неактивные пункты оглавления. Не применяется к активному пункту и всем его родительским пунктам.

Допустимые значения:

- `inifinity` (по умолчанию) — меню будет раскрыто полностью.
- любое целое положительное число — меню будет раскрыто до этого уровня.

### `html.combined_toc` {#volume.html.combined_toc}

Эта опция позволяет встраивать локальное оглавление страницы внутрь глобального оглавления.

Допустимые значения:

- `never` (по умолчанию) — не встраивать локальное оглавление в глобальное.
- `current` — встраивать локальное оглавление текущей страницы.
- `always` — встраивать локальное оглавление каждой страницы.

### `html.prefix` {#volume.html.prefix}

Шаблон пути к поддиректории для выходных HTML-файлов отдельно взятого тома.

Если настройка не задана, она считается равной `$AUTOPREFIX`, что означает автоматическое создание поддиректорий для каждого языка, а внутри — для каждого тома.

В значении могут использоваться переменные:

- `$LANG` — язык текста.
- `$VOLUME` — кодовое имя тома.
- `$AUTOPREFIX` — [идентификатор тома](../1-concepts/1-volumes.md#volume-id) (в общем случае то же, что `$LANG/$VOLUME`).

### `html.resources_prefix` {#volume.html.resources_prefix}

Поддиректория в выходной директории, в которую будут скопированы изображения, видео и прочие ресурсы для документации из директории [`paths.resources`](#volume.paths.resources).

Если настройка не задана, используется директория “_resources”.

### `html.resources_force_copy` {#volume.html.resources_force_copy}

Список файлов, которые следует скопировать из [`paths.resources`](#volume.paths.resources) в [`html.resources_prefix`](#volume.html.resources_prefix) принудительно, даже если на них не ссылается ни одна страница документации. Например, здесь может быть необходимо указать путь к иконке проекта, на которую может сослаться используемая тема.

### `html.theme` {#volume.html.theme}

Название или путь к директории с HTML-темой.

При чтении этой настройки Собирака сначала пытается найти указанную тему в директории, в которой находится файл манифеста. Если тема не найдена, поиск продолжается в дистрибутиве самой Собираки, куда входят три темы:

- `simple` — некрасивая тема с минимумом CSS для отладки и прототипирования.
- `material` — тема на основе [Material for Sphinx](https://bashtage.github.io/sphinx-material/).
- `book` — тема на основе [Hugo Book Theme](https://github.com/alex-shpak/hugo-book). Используется в документации, которую вы сейчас читаете.

Если настройка не задана, используется тема `simple`.

### `html.theme_data` {#volume.html.theme_data}

Словарь, который будет в неизменном виде передан шаблонизатору в качестве переменной `theme_data`. Поддержка и ожидаемые ключи и значения в этом словаре зависят от используемой темы.

### `pdf.header` {#volume.pdf.header}

Путь к файлу в формате STY, содержимое которого будет включено в начало генерируемого LaTeX-кода.

### `pdf.paths` {#volume.pdf.paths}

Словарь с относительными путями, каждый из которых будет превращён в относительный и передан в LaTeX в качестве переменной.

### `pdf.theme` {#volume.pdf.theme}

Название или путь к директории с PDF-темой.

При чтении этой настройки Собирака сначала пытается найти указанную тему в директории, в которой находится файл манифеста. Если тема не найдена, поиск продолжается в дистрибутиве самой Собираки.

Из тем, входящих в дистрибутив Собираки, только тема `simple` в данный момент поддерживает формат PDF.

Если настройка не задана, используется тема `simple`.

### `pdf.toc` {#volume.pdf.toc}

Если `true` (по умолчанию), то в PDF будет включено оглавление, автоматически сгенерированное при помощи LaTeX.

### `lint.dictionaries` {#volume.lint.dictionaries}

Список словарей, которые Собирака будет использовать при проверке правописания. В качестве словарей можно использовать:

- `en_US`, `ru_RU` — словари, включённые в дистрибутив Собираки;
- названия словарей для Hunspell, установленных в вашей системе;
- относительные пути к словарям для Hunspell, расположенным локально в директории проекта.

Если настройка не задана, проверка правописания выполняться не будет.

### `lint.exceptions` {#volume.lint.exceptions}

Список файлов со словами-исключениями, которые Собирака будет использовать при проверке правописания.

В файлах с расширением `.regexp` каждая строка будет интерпретирована как регулярное выражение, совместимое со стандартной библиотекой [`re`](https://docs.python.org/3/library/re.html) в Python. В любых других файлах каждая строка будет интерпретирована как точное написание слова.

В отличие от словарей, подключаемых через [`lint.dictionaries`](#volume.lint.dictionaries), слова-исключения могут содержать точки и пробелы.

### `lint.checks` {#volume.lint.checks}

Проверки, которые необходимо выполнить, помимо проверки правописания. Эта настройка задаётся в виде словаря, где ключами являются названия проверок, а значениями — `true` или `false`.

В данный момент поддерживается только одна проверка:

- `phrases_must_begin_with_capitals` (по умолчанию `true`)

### `variables` {#volume.variables}

Дополнительные переменные, которые будут переданы шаблонизатору при рендеринге каждой HTML-страницы.
