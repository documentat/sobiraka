# Оглавления

@manual-toc --local --ordered --unique

Собирака позволяет техническому писателю вставлять [оглавления по подразделам и страницам](#toc-in-sections-and-pages) там, где они необходимы. Если технический писатель составляет список ссылок самостоятельно, Собирака может [проверить получившийся список](#manual-toc) во время сборки. Также Собирака генерирует [оглавления для темы оформления](#navigation) в местах, предусмотренных разработчиком темы.

Оглавления генерируются на одном из последних шагов сборки, когда уже известны и заголовки всех страниц, и даже подзаголовки внутри страниц. Это позволяет, если необходимо, создавать «сквозные оглавления» — оглавления, в которые включены пункты, ведущие на подзаголовки каждой страницы.

В качестве текста ссылки на каждую страницу используется свойство [`toc_title`](metadata.md#toc_title) или [`title`](metadata.md#title) из её метаданных или заголовок первого уровня.

## Оглавления по подразделам и страницам {#toc-in-sections-and-pages}

С помощью специальной директивы [`@toc`](../writing/directives.md#toc) технический писатель может поместить на любую страницу список ссылок на её подразделы или дочерние страницы.

При сортировке ссылок и формировании их текстов директива следует правилам, описанным в разделах [](files.md) и [](nav.md).

## Составление оглавлений вручную {#manual-toc}

В некоторых ситуациях технический писатель может предпочесть заменить простой список ссылок на произвольный текст, выполняющий ту же роль. Например, вы можете написать введение к статье и включить в него ссылки на её подразделы. В документации, которую вы сейчас читаете, такой подход используется в нескольких местах, например, во вводной части статьи [](../writing/links.md).

Частая проблема, связанная с такими «самодельными оглавлениями», возникает при дальнейшем редактировании статьи: технический писатель может забыть добавить в оглавление новые пункты, которые он добавил в саму статью. Специальная директива [`@manual-toc`](../writing/directives.md#manual-toc) предотвращает эту проблему, проверяя, все ли необходимые ссылки содержатся в указанном фрагменте текста.

## Генерация оглавлений для навигации {#navigation}

Разработчикам тем оформления для Собираки доступны две функции для генерации оглавлений:

- [`toc()`](../../../src/sobiraka/processing/toc.py#:~:text=def%20toc) — полное оглавление от корня текущего тома;
- [`local_toc()`](../../../src/sobiraka/processing/toc.py#:~:text=def%20local_toc) (только для [HTML](../build-html/)) — оглавление по подразделам текущей страницы.

Результаты обеих функций представляют собой объектно-ориентированные аналоги вывода директивы [`@toc`](../writing/directives.md#toc). Разработчик темы должен выполнить рекурсивную итерацию по элементам результата и поместить их в нужное место страницы. Примеры итерации можно посмотреть в специальном простом шаблоне [`simple/web.html`](../../../src/sobiraka/files/themes/simple/web.html).

Обеим функциям передаются параметры по умолчанию в соответствии с настройками [`web.combined_toc`](../reference/configuration.md#web.combined_toc), [`web.toc_depth`](../reference/configuration.md#web.toc_depth) и [`pdf.toc_depth`](../reference/configuration.md#pdf.toc_depth). Например, при настройке `web.combined_toc: always` результат вызова `toc()` будет аналогичен выводу директивы `@toc --combined`.