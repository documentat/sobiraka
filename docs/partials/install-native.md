{% set PUBLIC_REPOSITORY_URL = os.environ.get('PUBLIC_REPOSITORY_URL', 'http://ссылка/на/репозиторий.git') %}

{% set windows = (OS == 'Windows') %}
{% set macos = (OS == 'macOS') %}
{% set ubuntu = (OS == 'Ubuntu') %}

{% set SLASH = '\\' if windows else '/' %}
{% set DOWNLOADS_DIR = 'C:\\Downloads\\' if windows else '/home/user/Downloads/' %}
{% set PROJECT_DIR = 'C:\\MyProject' if windows else '/home/user/MyProject' %}
{% set VENV_DIR = 'C:\\MyProject\\venv' if windows else '/home/user/MyProject/venv' %}
{% set VENV_BIN = 'C:\\MyProject\\venv\\Scripts\\' if windows else '/home/user/MyProject/venv/bin/' %}

# Установка Собираки в {{ OS }}

Прежде чем продолжить, убедитесь, что вы можете запустить командную строку.
{% if windows -%}
В зависимости от ваших настроек и предпочтений вы можете найти её под названием **Командная строка**, **PowerShell** или **Git Bash**.
{%- endif %}

В конце некоторых этапов установки будет показано, как проверить в командной строке, что установка прошла успешно. Окно командной строки лучше открывать заново перед каждой такой проверкой, иначе она может «не узнать» о свежеустановленных программах.

{% if windows %}

Обратите внимание, что все инструменты должны в конечном итоге оказаться доступными в одном и том же варианте командной строки. Например, если вы решили использовать **Git Bash**, то используйте именно его во всех пунктах.

::: warning
Если вы используете Git Bash, во всех путях используйте прямой слеш, а не обратный: `/`, а не `\`.
:::

{% endif %}

## 1. Установка Python {#install-python}

Для запуска Собираки потребуется Python версии {{ PYTHON_VERSION_MIN }} или выше. На момент написания инструкции актуальная версия {{ PYTHON_VERSION_LATEST }}, она тоже подходит.

{% if windows %}

1. Зайдите на страницу <https://www.python.org/downloads/>.

1. Нажмите большую жёлтую кнопку, чтобы скачать установщик Python.

1. Запустите установщик.

   На первом экране установщика мы рекомендуем поставить чекбокс **Add Python {{ PYTHON_VERSION_LATEST }} to PATH**, чтобы командная строка Windows понимала короткую команду `python` вместо громоздкого пути до файла `python.exe`.

1. Пройдите все шаги установщика до конца.

{% elif ubuntu %}

1. Откройте окно командной строки и введите следующую команду:

   ```sh
   sudo apt install python3 --yes
   ```

   Впрочем, скорее всего, программа завершится мгновенно, так как в современных версиях Ubuntu сразу предустанавливаются современные версии Python.

{% endif %}

1. Чтобы проверить установку, откройте окно командной строки и введите следующую команду. {% if windows %} Если вы не поставили чекбокс при установке (см. выше), то замените здесь `python` на полный путь — что-то типа `C:\Python\python.exe`. {% endif %}

   ```sh
   python --version
   ```

   Должен появиться текст наподобие `Python {{ PYTHON_VERSION_LATEST }}`. Если версия не ниже {{ PYTHON_VERSION_MIN }}, значит, всё отлично.

## 2. Установка Pandoc {#install-pandoc}

Pandoc — необходимый инструмент, без которого Собирака не может работать. Корректная работа Собираки проверена с версиями Pandoc от {{ PANDOC_VERSION_MIN }} до {{ PANDOC_VERSION_MAX }}. У других версий могут отличаться внутренние форматы данных, и Собирака может их не понимать.

{% if windows %}

1. Скачайте установщик Pandoc: [`pandoc-{{ PANDOC_VERSION_MAX }}-windows-x86_64.msi`](https://github.com/jgm/pandoc/releases/download/{{ PANDOC_VERSION_MAX }}/pandoc-{{ PANDOC_VERSION_MAX }}-windows-x86_64.msi).

1. Запустите установщик и пройдите все его шаги до конца.

{% elif ubuntu %}

1. Скачайте пакет Pandoc: [`pandoc-{{ PANDOC_VERSION_MAX }}-1-amd64.deb`](https://github.com/jgm/pandoc/releases/download/{{ PANDOC_VERSION_MAX }}/pandoc-{{ PANDOC_VERSION_MAX }}-1-amd64.deb).

1. Откройте окно командной строки и перейдите в директорию, в которую вы сохранили пакет. Например:

   ```sh
   cd /home/user/Downloads
   ```
   
1. Выполните следующую команду:

   ```sh
   sudo dpkg -i pandoc-{{ PANDOC_VERSION_MAX }}-1-amd64.deb
   ```

{% endif %}

1. Чтобы проверить установку, откройте окно командной строки и введите следующую команду.

   ```sh
   pandoc --version
   ```

   Должен появиться абзац текста, начинающийся со строчки `pandoc {{ PANDOC_VERSION_MAX }}`.

## 3. Подготовка окружения {#configure-environment}

Чтобы Собирака и требуемые для неё пакеты не мешали другим проектам на Python, которые могут оказаться на вашем компьютере сейчас или в будущем, мы создадим отдельное виртуальное окружение Python и установим Собираку в него.

Всё виртуальное окружение будет храниться в одной папке. Часто для этой цели создают поддиректорию под названием `venv` в папке с документацией. Но это необязательно. Можно выбрать для папки другое название или разместить её в другом месте. В примерах ниже будет использована папка `{{ VENV_DIR }}`.

1. Откройте окно командной строки и введите следующую команду. Подставьте путь к вашему виртуальному окружению{% if windows %}, а также при необходимости замените `python` на полный путь до файла `python.exe`{% endif %}.

   ```sh
   python -m venv {{ VENV_DIR }}
   ```

1. Обновите менеджер пакетов для Python до последней версии.

   ```sh
   {{ VENV_BIN }}pip install --upgrade pip
   ```

## 4. Установка Собираки {#install-sobiraka}

Непосредственно сама Собирака занимает совсем немного места. Она написана на языке Python и полагается на перечисленные выше инструменты, чтобы выполнять всю грязную работу.

На этом этапе будет установлена сама Собирака, а также несколько зависимостей. Для установки используется `pip` — менеджер зависимостей для Python.

1. Откройте окно командной строки и введите следующую команду, чтобы установить или обновить Собираку в виртуальном окружении. Не забудьте подставить в команду правильный путь к вашему виртуальному окружению.

   ```sh
   {{ VENV_BIN }}pip install git+{{ PUBLIC_REPOSITORY_URL }}
   ```

1. Чтобы проверить установку, выполните следующую команду.

   ```sh
   {{ VENV_BIN }}sobiraka --help
   ```

   Должен появиться краткий перечень доступных команд, начинающийся со слов `usage: sobiraka`. Если вы его видите — значит, всё прошло идеально!

## 5. Сборка документации {#build-docs}

Осталось сделать самое главное: начать писать документацию и собирать её с помощью Собираки.

1. Создайте новую папку для документации, а в ней — подпапку `src`.

1. В папке документации создайте файл [`sobiraka.yaml`](../reference/configuration.md) следующего содержания:

   ```yaml
   title: Пример документации
   paths:
     root: src
   ```
   
1. В подпапке `src` создайте файл `_index.md` следующего содержания:

       # Пример документации
       Эта документация собирается Собиракой.

1. Откройте окно командной строки и перейдите в папку документации. Например:

       cd {{ PROJECT_DIR }}

1. Чтобы собрать документацию в формате HTML, выполните следующую команду. Не забудьте подставить путь к вашему виртуальному окружению.

       {{ VENV_BIN }}sobiraka web

   Когда сборка завершится, готовые файлы должны появиться в поддиректории `build{{ SLASH }}web`. Посмотреть документацию можно в любом браузере, открыв файл `build{{ SLASH }}web{{ SLASH }}index.html`.

1. Чтобы собрать документацию в формате PDF, выполните следующую команду.  Не забудьте подставить путь к вашему виртуальному окружению.

       {{ VENV_BIN }}sobiraka pdf

   Когда сборка завершится, готовый PDF-файл должен появиться в поддиректории `build{{ SLASH }}pdf`.