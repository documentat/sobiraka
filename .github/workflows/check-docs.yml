on:
  workflow_call:

jobs:
  prover:
    name: Check documentation
    runs-on: self-hosted
    container: ${{ (github.ref == 'refs/heads/master') && vars.DOCKER_PROD_IMAGE || vars.DOCKER_DEV_IMAGE }}:${{ github.sha }}
    steps:
      - uses: actions/checkout@v4
        with:
          sparse-checkout: docs

      - run: cd docs && sobiraka prover

      - run: rm -rf * .* || true

  find-dictionaries:
    name: Find dictionaries
    outputs:
      dic_files: ${{ steps.ls.outputs.dic_files }}
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4
        with:
          sparse-checkout: docs/dictionaries/hunspell

      - id: ls
        shell: bash
        run: >
          echo dic_files=$(
          cd docs/dictionaries/hunspell
          && find * -name '*.dic'
          | jq --raw-input --compact-output --slurp 'split("\n")[:-1]'
          ) >> $GITHUB_OUTPUT

  validate-dictionaries:
    strategy:
      fail-fast: false
      matrix:
        dic_file: ${{ fromJSON(needs.find-dictionaries.outputs.dic_files) }}

    name: Validate ${{ matrix.dic_file }}
    needs: [find-dictionaries]
    runs-on: self-hosted
    container: ${{ (github.ref == 'refs/heads/master') && vars.DOCKER_PROD_IMAGE || vars.DOCKER_DEV_IMAGE }}:${{ github.sha }}
    steps:
      - uses: actions/checkout@v4
        with:
          sparse-checkout: docs/dictionaries/hunspell/${{ matrix.dic_file }}

      - run: sobiraka validate_dictionary docs/dictionaries/hunspell/${{ matrix.dic_file }}

      - run: rm -rf * .* || true